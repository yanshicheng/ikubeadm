# Ansible Role: Chrony

# Chrony è§’è‰²

![æ—¶é—´åŒæ­¥](https://img.shields.io/badge/%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5-Chrony-blue)![Ansible](https://img.shields.io/badge/Ansible-Role-red)![ç‰ˆæœ¬](https://img.shields.io/badge/Version-1.0-green)

## ğŸ“‹ ç®€ä»‹

`chrony` è§’è‰²ç”¨äºéƒ¨ç½²å’Œç®¡ç† Chrony æ—¶é—´åŒæ­¥æœåŠ¡ï¼Œå®ƒæ˜¯ç°ä»£ Linux ç³»ç»Ÿä¸Š NTP çš„æ›¿ä»£å“ï¼Œæä¾›æ›´é«˜ç²¾åº¦å’Œæ›´å¥½çš„ç¨³å®šæ€§ã€‚è¯¥è§’è‰²æ”¯æŒå°†æœåŠ¡å™¨é…ç½®ä¸º NTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼Œç¡®ä¿ç³»ç»Ÿæ—¶é—´åœ¨é›†ç¾¤å†…éƒ¨æˆ–ä¸å¤–éƒ¨æƒå¨æ—¶é—´æºä¿æŒåŒæ­¥ã€‚

ä¸ä¼ ç»Ÿçš„ NTP ç›¸æ¯”ï¼ŒChrony åœ¨ä¸ç¨³å®šç½‘ç»œæ¡ä»¶ä¸‹è¡¨ç°æ›´å¥½ï¼Œå¯åŠ¨åèƒ½æ›´å¿«åœ°åŒæ­¥æ—¶é—´ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¤„ç†é—´æ­‡æ€§è¿æ¥å’Œå˜åŒ–çš„æ—¶é’Ÿé¢‘ç‡ï¼ˆç‰¹åˆ«é€‚ç”¨äºè™šæ‹Ÿç¯å¢ƒï¼‰ã€‚

## ğŸ¯ é€‚ç”¨åœºæ™¯

* **æœåŠ¡å™¨é›†ç¾¤ç¯å¢ƒ**ï¼šç¡®ä¿é›†ç¾¤å†…æ‰€æœ‰èŠ‚ç‚¹æ—¶é—´ä¸€è‡´
* **Kubernetes é›†ç¾¤**ï¼šä¸ºå®¹å™¨ç¼–æ’å’Œåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›æ—¶é—´åŒæ­¥
* **æ•°æ®åº“æœåŠ¡å™¨**ï¼šéœ€è¦ç²¾ç¡®æ—¶é—´æˆ³çš„äº‹åŠ¡å¤„ç†ç³»ç»Ÿ
* **è™šæ‹ŸåŒ–ç¯å¢ƒ**ï¼šè§£å†³è™šæ‹Ÿæœºæ—¶é’Ÿæ¼‚ç§»é—®é¢˜
* **å®‰å…¨æ•æ„Ÿç³»ç»Ÿ**ï¼šéœ€è¦ç²¾ç¡®æ—¶é—´è®°å½•çš„å®¡è®¡å’Œæ—¥å¿—ç³»ç»Ÿ
* **è¾¹ç¼˜è®¡ç®—è®¾å¤‡**ï¼šé—´æ­‡æ€§è¿æ¥äº’è”ç½‘çš„è®¾å¤‡
* **æ›¿æ¢ä¼ ç»Ÿ NTP æœåŠ¡**ï¼šä»æ—§å¼ NTP æœåŠ¡è¿ç§»åˆ°æ›´ç°ä»£çš„æ—¶é—´åŒæ­¥è§£å†³æ–¹æ¡ˆ

## âœ¨ åŠŸèƒ½è¯´æ˜

### ğŸ”„ åŸºç¡€åŠŸèƒ½

* **åŒé‡è§’è‰²æ”¯æŒ**ï¼šå¯é…ç½®ä¸º NTP æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯
* **æ™ºèƒ½æ¨¡å¼åˆ‡æ¢**ï¼šæ ¹æ®ä¸»æœºç»„å’Œå˜é‡è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„é…ç½®æ¨¡å¼
* **è‡ªåŠ¨æ£€æµ‹**ï¼šè¯†åˆ«å¹¶åº”ç”¨é€‚åˆå½“å‰æ“ä½œç³»ç»Ÿçš„é…ç½®

### ğŸ”§ æœåŠ¡å™¨æ¨¡å¼åŠŸèƒ½

* **ä¸Šæ¸¸æ—¶é—´æºé…ç½®**ï¼šæ”¯æŒé…ç½®å¤šä¸ªå¤–éƒ¨ NTP æœåŠ¡å™¨
* **è®¿é—®æ§åˆ¶**ï¼šå¯é™åˆ¶å…è®¸åŒæ­¥çš„å®¢æˆ·ç«¯ç½‘ç»œ
* **æœ¬åœ°å±‚çº§è®¾ç½®**ï¼šå½“æ— æ³•è¿æ¥å¤–éƒ¨æ—¶é—´æºæ—¶æä¾›å¤‡ç”¨æ—¶é—´æœåŠ¡
* **é˜²ç«å¢™è‡ªåŠ¨é…ç½®**ï¼šå¯é€‰æ‹©æ€§åœ°é…ç½®é˜²ç«å¢™è§„åˆ™

### ğŸ“± å®¢æˆ·ç«¯æ¨¡å¼åŠŸèƒ½

* **è‡ªåŠ¨æœåŠ¡å™¨å‘ç°**ï¼šè‡ªåŠ¨è¿æ¥åˆ° Ansible æ¸…å•ä¸­å®šä¹‰çš„ Chrony æœåŠ¡å™¨
* **å¤‡ä»½æœåŠ¡å™¨æœºåˆ¶**ï¼šå½“å†…éƒ¨æœåŠ¡å™¨ä¸å¯ç”¨æ—¶å›é€€åˆ°å…¬å…± NTP æœåŠ¡å™¨
* **æ­¥è¿›æ—¶é—´æ ¡æ­£**ï¼šå¤§åå·®æ—¶å…è®¸æ—¶é—´æ­¥è¿›è€Œéç¼“æ…¢è°ƒæ•´
* **RTC åŒæ­¥**ï¼šä¸ç¡¬ä»¶æ—¶é’Ÿä¿æŒåŒæ­¥

### ğŸ› ï¸ é«˜çº§åŠŸèƒ½

* **æœåŠ¡å¥åº·æ£€æŸ¥**ï¼šéƒ¨ç½²åéªŒè¯æœåŠ¡çŠ¶æ€å’ŒåŒæ­¥æƒ…å†µ
* **ç¡¬ä»¶æ—¶é—´æˆ³æ”¯æŒ**ï¼šå¯é…ç½®ç‰¹å®šç½‘ç»œæ¥å£çš„ç¡¬ä»¶æ—¶é—´æˆ³
* **å®‰å…¨é…ç½®é€‰é¡¹**ï¼šæ”¯æŒ NTP èº«ä»½éªŒè¯
* **æ—¥å¿—åŠŸèƒ½**ï¼šæ”¯æŒè¯¦ç»†çš„è¿½è¸ªã€æµ‹é‡å’Œç»Ÿè®¡æ—¥å¿—

## ğŸ“ å˜é‡è¯´æ˜

### åŸºæœ¬é…ç½®å˜é‡


| å˜é‡å               | é»˜è®¤å€¼                             | è¯´æ˜                       |
| -------------------- | ---------------------------------- | -------------------------- |
| `chrony_server_mode` | `true`                             | æ˜¯å¦å¯ç”¨æœåŠ¡å™¨æ¨¡å¼         |
| `chrony_driftfile`   | `/var/lib/chrony/drift`            | è®°å½•æ—¶é’Ÿé¢‘ç‡åå·®çš„æ–‡ä»¶è·¯å¾„ |
| `chrony_log_dir`     | `/var/log/chrony`                  | æ—¥å¿—ç›®å½•                   |
| `chrony_rtcsync`     | `true`                             | æ˜¯å¦å¯ç”¨å®æ—¶æ—¶é’ŸåŒæ­¥       |
| `chrony_log_options` | `tracking measurements statistics` | æ—¥å¿—è®°å½•é€‰é¡¹               |

### æœåŠ¡å™¨é…ç½®å˜é‡


| å˜é‡å                      | é»˜è®¤å€¼                                     | è¯´æ˜                                 |
| --------------------------- | ------------------------------------------ | ------------------------------------ |
| `chrony_allow_networks`     | `["127.0.0.1/32", "::1/128", "0.0.0.0/0"]` | å…è®¸è®¿é—® NTP æœåŠ¡çš„ç½‘ç»œåˆ—è¡¨          |
| `chrony_local_stratum`      | `10`                                       | æœ¬åœ°å±‚çº§å€¼ï¼ˆå½“æ— æ³•è¿æ¥ä¸Šæ¸¸æœåŠ¡å™¨æ—¶ï¼‰ |
| `chrony_configure_firewall` | `false`                                    | æ˜¯å¦è‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™               |

### æ—¶é—´æºé…ç½®å˜é‡


| å˜é‡å                          | é»˜è®¤å€¼                                                      | è¯´æ˜                         |
| ------------------------------- | ----------------------------------------------------------- | ---------------------------- |
| `chrony_ntp_servers`            | `[{"server": "ntp1.aliyun.com", "options": "iburst"}, ...]` | ä¸Šæ¸¸ NTP æœåŠ¡å™¨åˆ—è¡¨          |
| `chrony_hwtimestamp_interfaces` | `[]`                                                        | å¯ç”¨ç¡¬ä»¶æ—¶é—´æˆ³çš„ç½‘ç»œæ¥å£åˆ—è¡¨ |

### æ—¶é—´è°ƒæ•´å˜é‡


| å˜é‡å                      | é»˜è®¤å€¼  | è¯´æ˜                                     |
| --------------------------- | ------- | ---------------------------------------- |
| `chrony_makestep_threshold` | `1.0`   | æ—¶é—´è·³å˜é˜ˆå€¼ï¼ˆç§’ï¼‰                       |
| `chrony_makestep_limit`     | `3`     | å…è®¸çš„æœ€å¤§æ—¶é—´è·³å˜æ¬¡æ•°                   |
| `chrony_maxupdateskew`      | `100.0` | æœ€å¤§æ›´æ–°åå·®ï¼ˆé˜²æ­¢é”™è¯¯ä¼°è®¡å½±å“ç³»ç»Ÿæ—¶é’Ÿï¼‰ |

### å®¢æˆ·ç«¯ä¸“ç”¨å˜é‡


| å˜é‡å                         | é»˜è®¤å€¼ | è¯´æ˜                 |
| ------------------------------ | ------ | -------------------- |
| `chrony_client_ignore_stratum` | `true` | æ˜¯å¦å¿½ç•¥æºå±‚çº§æƒé‡   |
| `chrony_leapsectz`             | `true` | æ˜¯å¦å¯ç”¨é—°ç§’æ—¶åŒºæ”¯æŒ |

### å®‰å…¨å˜é‡


| å˜é‡å                      | é»˜è®¤å€¼                          | è¯´æ˜                         |
| --------------------------- | ------------------------------- | ---------------------------- |
| `chrony_use_authentication` | `false`                         | æ˜¯å¦å¯ç”¨ NTP èº«ä»½éªŒè¯        |
| `chrony_key_id`             | `1`                             | è®¤è¯å¯†é’¥ ID                  |
| `chrony_key_value`          | `ChangeThisToASecureKeyInVault` | è®¤è¯å¯†é’¥å€¼ï¼ˆåº”æ›¿æ¢ä¸ºå®‰å…¨å€¼ï¼‰ |

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºæœ¬ç”¨æ³•

1. åœ¨ Ansible æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰ Chrony æœåŠ¡å™¨ç»„ï¼š

```ini
[chrony]
chrony-server-1
chrony-server-2

[app_servers]
app-server-1
app-server-2
```

2. åœ¨ playbook ä¸­åº”ç”¨è§’è‰²ï¼š

```yaml
- hosts: all
  roles:
    - chrony
```

### æœåŠ¡å™¨æ¨¡å¼é…ç½®

```yaml
- hosts: chrony
  vars:
    chrony_server_mode: true
    chrony_allow_networks:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"
    chrony_configure_firewall: true
  roles:
    - chrony
```

### å®¢æˆ·ç«¯æ¨¡å¼é…ç½®

```yaml
- hosts: app_servers
  vars:
    chrony_server_mode: false
    chrony_makestep_threshold: 0.5
    chrony_makestep_limit: 5
  roles:
    - chrony
```

### é«˜çº§ç”¨æ³•

1. ä½¿ç”¨è‡ªå®šä¹‰ NTP æœåŠ¡å™¨ï¼š

```yaml
- hosts: all
  vars:
    chrony_ntp_servers:
      - server: "ntp.example.com"
        options: "iburst prefer"
      - server: "time.example.org"
        options: "iburst"
  roles:
    - chrony
```

2. å¯ç”¨ NTP è®¤è¯ï¼š

```yaml
- hosts: all
  vars:
    chrony_use_authentication: true
    chrony_key_id: 42
    chrony_key_value: "{{ vault_chrony_key }}" # ä½¿ç”¨ Ansible Vault å­˜å‚¨å¯†é’¥
  roles:
    - chrony
```

3. ä»…è¿è¡Œç‰¹å®šä»»åŠ¡ï¼ˆä½¿ç”¨æ ‡ç­¾ï¼‰ï¼š

```bash
ansible-playbook playbook.yml --tags "configure,service"
```

4. é’ˆå¯¹ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„ NTP æºï¼š

```yaml
# group_vars/production.yml
chrony_ntp_servers:
  - server: "time.production.example.com"
    options: "iburst"

# group_vars/development.yml
chrony_ntp_servers:
  - server: "time.dev.example.com"
    options: "iburst"
```

### æœ€ä½³å®è·µ

* è‡³å°‘é…ç½® 3-4 ä¸ª NTP æœåŠ¡å™¨ä»¥æé«˜å¯é æ€§
* åœ¨å†…éƒ¨ç½‘ç»œä¸­è®¾ç½® 2-3 ä¸ª Chrony æœåŠ¡å™¨ä½œä¸ºæ—¶é—´æº
* ä½¿ç”¨ `iburst` é€‰é¡¹åŠ é€Ÿåˆå§‹åŒæ­¥
* å®šæœŸæ£€æŸ¥ Chrony çŠ¶æ€ï¼š`chronyc tracking` å’Œ `chronyc sources -v`
* è€ƒè™‘ä½¿ç”¨åœ°ç†ä½ç½®æ¥è¿‘çš„å…¬å…± NTP æ± æœåŠ¡å™¨
* ä¸ºé‡è¦çš„ç¯å¢ƒå¯ç”¨é˜²ç«å¢™è§„åˆ™ï¼Œé™åˆ¶ NTP è®¿é—®

### ç›‘æ§ä¸éªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹æ—¶é—´æºçŠ¶æ€
chronyc sources -v

# æŸ¥çœ‹å½“å‰åŒæ­¥è¯¦æƒ…
chronyc tracking

# æ£€æŸ¥ Chrony æ´»åŠ¨
journalctl -u chronyd
```

## âš ï¸ æ³¨æ„äº‹é¡¹

* å˜æ›´ç³»ç»Ÿæ—¶é—´å¯èƒ½ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº
* å¯ç”¨èº«ä»½éªŒè¯éœ€è¦ç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é…ç½®åŒ¹é…
* åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè™šæ‹Ÿæœºæ—¶é’Ÿå¯èƒ½ä¼šæ¼‚ç§»ï¼Œå»ºè®®åˆç†é…ç½® `makestep` å‚æ•°
* é˜²ç«å¢™é…ç½®éœ€è¦ç¡®ä¿ UDP ç«¯å£ 123 å¯è®¿é—®
* é¿å…åœ¨åŒä¸€ç½‘ç»œä¸­æ··åˆä½¿ç”¨ä¸åŒçš„æ—¶é—´åŒæ­¥æœåŠ¡ï¼ˆå¦‚ ntpd å’Œ chronydï¼‰

---

ğŸ”§ å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»æ‚¨çš„ç³»ç»Ÿç®¡ç†å‘˜æˆ–é¡¹ç›®è´Ÿè´£äººã€‚

è¿™ä¸ª Ansible è§’è‰²ç”¨äºå®‰è£…å’Œé…ç½® Chrony NTP æœåŠ¡ï¼Œæ”¯æŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¨¡å¼ã€‚Chrony æ˜¯ä¸€ä¸ªå®ç°ç½‘ç»œæ—¶é—´åè®® (NTP) çš„è½¯ä»¶ï¼Œå¯ä»¥ä¿æŒç³»ç»Ÿæ—¶é’Ÿä¸å‚è€ƒæ—¶é—´æºåŒæ­¥ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

* æ”¯æŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¤ç§éƒ¨ç½²æ¨¡å¼
* é€šè¿‡ `CHRONY_SERVER_DEPLOY` å˜é‡çµæ´»æ§åˆ¶éƒ¨ç½²æ¨¡å¼
* è‡ªåŠ¨å®‰è£…å’Œé…ç½® Chrony
* çµæ´»çš„æœåŠ¡å™¨æ—¶é—´æºé…ç½®
* è‡ªåŠ¨é…ç½®é˜²ç«å¢™è§„åˆ™ï¼ˆå¯é€‰ï¼‰
* æ”¯æŒå¤šç§ Linux å‘è¡Œç‰ˆï¼ˆRHEL/CentOS 7/8/9ã€Debianã€Ubuntuï¼‰
* å®¢æˆ·ç«¯æ™ºèƒ½é€‰æ‹©å¯ç”¨çš„ NTP æœåŠ¡å™¨
* ä½¿ç”¨æ ‡ç­¾å¯ä»¥å•ç‹¬éƒ¨ç½²æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯

## ç³»ç»Ÿè¦æ±‚

* Ansible 2.9 æˆ–æ›´é«˜ç‰ˆæœ¬
* æ”¯æŒçš„æ“ä½œç³»ç»Ÿ:
  * RHEL/CentOS 7/8/9
  * Debian 11/12 (Bullseye/Bookworm)
  * Ubuntu 18.04/20.04/22.04 (Bionic/Focal/Jammy)

## ä¸»è¦å˜é‡

### é€šç”¨é…ç½®

```yaml
# é…ç½®æ–‡ä»¶è·¯å¾„
chrony_driftfile: "/var/lib/chrony/drift"
chrony_log_dir: "/var/log/chrony"

# é˜²ç«å¢™é…ç½®
chrony_configure_firewall: false # æ˜¯å¦é…ç½®é˜²ç«å¢™

# éƒ¨ç½²æ§åˆ¶
CHRONY_SERVER_DEPLOY: true  # è®¾ç½®ä¸º true éƒ¨ç½²æœåŠ¡ç«¯ï¼Œfalse éƒ¨ç½²å®¢æˆ·ç«¯
```

### æœåŠ¡å™¨é…ç½®

```yaml
# æœåŠ¡å™¨é…ç½®é€‰é¡¹
chrony_server_mode: true # è®¾ç½®ä¸º true å¯ç”¨æœåŠ¡å™¨æ¨¡å¼
chrony_allow_networks:
  - "127.0.0.1/32" # æœ¬åœ°å›ç¯åœ°å€
  - "::1/128" # IPv6 æœ¬åœ°å›ç¯åœ°å€
  - "0.0.0.0/0" # å…è®¸æ‰€æœ‰ç½‘ç»œè®¿é—®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
  # - "192.168.0.0/24" # å†…ç½‘ç¤ºä¾‹

# ä¸Šæ¸¸ NTP æœåŠ¡å™¨åˆ—è¡¨
chrony_ntp_servers:
  - server: "ntp1.aliyun.com"
    options: "iburst"
  - server: "time1.cloud.tencent.com"
    options: "iburst"
  - server: "0.cn.pool.ntp.org"
    options: "iburst"

# é«˜çº§é€‰é¡¹
chrony_makestep_threshold: 1.0 # æ—¶é—´è·³å˜é˜ˆå€¼ï¼ˆç§’ï¼‰
chrony_makestep_limit: 3 # å…è®¸çš„æœ€å¤§æ—¶é—´è·³å˜æ¬¡æ•°
chrony_rtcsync: true # æ˜¯å¦å¯ç”¨å®æ—¶æ—¶é’ŸåŒæ­¥
chrony_local_stratum: 10 # æœ¬åœ°å±‚çº§ï¼ˆå½“æ— æ³•è¿æ¥åˆ°ä¸Šæ¸¸æœåŠ¡å™¨æ—¶ï¼‰
```

## æ¸…å•æ–‡ä»¶ç¤ºä¾‹

```ini
# NTP æœåŠ¡å™¨èŠ‚ç‚¹
[chrony]
ntp-server-1 CHRONY_SERVER_DEPLOY=true  # éƒ¨ç½² chrony æœåŠ¡ç«¯
ntp-server-2 CHRONY_SERVER_DEPLOY=false # ä¸éƒ¨ç½² chrony æœåŠ¡ç«¯ï¼ˆå·²ç»éƒ¨ç½²è¿‡ï¼‰

# å®¢æˆ·ç«¯èŠ‚ç‚¹
[clients]
client-1
client-2
client-3
```

## Playbook ç¤ºä¾‹

### å®Œæ•´éƒ¨ç½²ï¼ˆæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼‰

```yaml
---
- name: é…ç½® Chrony NTP æœåŠ¡å™¨
  hosts: chrony
  become: true
  roles:
    - chrony

- name: é…ç½® Chrony å®¢æˆ·ç«¯
  hosts: all:!chrony
  become: true
  roles:
    - chrony
```

### ä»…éƒ¨ç½²æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯

```yaml
---
- name: é…ç½® Chrony NTP æœåŠ¡
  hosts: all
  become: true
  roles:
    - role: chrony
      tags: [ server ]  # ä½¿ç”¨ server æˆ– client æ ‡ç­¾
```

## æ ‡ç­¾

æ­¤è§’è‰²æä¾›ä»¥ä¸‹æ ‡ç­¾ï¼š

* `chrony` - åº”ç”¨äºæ‰€æœ‰ä»»åŠ¡
* `install` - ä»…å®‰è£… Chrony è½¯ä»¶åŒ…
* `configure` - ä»…é…ç½® Chrony
* `firewall` - ä»…é…ç½®é˜²ç«å¢™
* `service` - ä»…ç®¡ç† Chrony æœåŠ¡
* `server` - æœåŠ¡å™¨ç‰¹å®šä»»åŠ¡
* `client` - å®¢æˆ·ç«¯ç‰¹å®šä»»åŠ¡

## éƒ¨ç½²é€‰é¡¹

1. å®Œæ•´éƒ¨ç½²ï¼š
   ```bash
   ansible-playbook playbook.yml
   ```
2. ä»…éƒ¨ç½²æœåŠ¡å™¨ï¼š
   ```bash
   ansible-playbook playbook.yml --tags "server"
   ```
3. ä»…éƒ¨ç½²å®¢æˆ·ç«¯ï¼š
   ```bash
   ansible-playbook playbook.yml --tags "client"
   ```
4. ä»…é…ç½®é˜²ç«å¢™ï¼š
   ```bash
   ansible-playbook playbook.yml --tags "firewall"
   ```

## æ•…éšœæ’é™¤

1. æ£€æŸ¥ Chrony æœåŠ¡çŠ¶æ€ï¼š
   ```bash
   systemctl status chronyd
   ```
2. æ£€æŸ¥åŒæ­¥çŠ¶æ€ï¼š
   ```bash
   chronyc tracking
   ```
3. æ£€æŸ¥æ—¶é—´æºï¼š
   ```bash
   chronyc sources
   ```
4. æ£€æŸ¥æ—¥å¿—ï¼š
   ```bash
   # RHEL/CentOS
   journalctl -u chronyd
   # Debian/Ubuntu
   journalctl -u chrony
   ```

## ç‰¹åˆ«è¯´æ˜

* å¯¹äºå·²ç»éƒ¨ç½²è¿‡ Chrony æœåŠ¡ç«¯çš„ä¸»æœºï¼Œå¯ä»¥è®¾ç½® `CHRONY_SERVER_DEPLOY=false` é¿å…é‡å¤éƒ¨ç½²
* è§’è‰²ä¼šè‡ªåŠ¨è¯†åˆ«æ“ä½œç³»ç»Ÿç±»å‹å¹¶åº”ç”¨ç›¸åº”çš„é…ç½®
* é»˜è®¤é…ç½®é€‚ç”¨äºå¤§å¤šæ•°åœºæ™¯ï¼Œå¯æŒ‰éœ€è°ƒæ•´å˜é‡

## ä½œè€…

è¯¥è§’è‰²ç”± Yan Shicheng åˆ›å»º

## è®¸å¯è¯

MIT
